{
  "version": 3,
  "sources": ["../src/uselottie/index.ts", "../src/uselottie/LottieController.ts", "../src/uselottie/SustainHowl.ts", "../src/uselottie/index.scss", "../src/uselottie/utils.ts"],
  "sourcesContent": ["import LottieController, { LottieControllerConfig } from \"./LottieController\";\n\n\n// LOTTIE\nexport default function useLottie(options: LottieControllerConfig): LottieController {\n  const controller = new LottieController(options);\n\n  // bind everything to the controller\n\n  return controller;\n}\n\ndeclare global {\n  function useLottie(options: LottieControllerConfig): LottieController;\n}\n\nglobalThis.useLottie = useLottie;\n", "import lottie, { AnimationConfigWithPath } from \"lottie-web\";\nimport SustainHowl, { SustainHowlOptions } from \"./SustainHowl\";\nimport styleContent from \"./index.scss?inline\";\n\nimport {\n  getElem,\n  getElems,\n  firstCap,\n  playAnimation,\n  random,\n  CompleteAnimationItem,\n  BMAudioEvent,\n  isIOS,\n} from \"./utils\";\n\nexport interface LottieControllerConfig\n  extends Omit<AnimationConfigWithPath, \"container\"> {\n  debug?: boolean;\n  injectCSS?: boolean;\n  variations?: { rate: number; volume: number };\n  volumeVariation?: number;\n  rateVariation?: number;\n  howlerOptions?: SustainHowlOptions;\n  container?: string | Element;\n}\n\ntype Callback = (event: any) => void;\n\nexport default class LottieController {\n  animation: string | null = null;\n  container: Element | null = null;\n  player: CompleteAnimationItem;\n  debug: boolean = false;\n  volumeVariation: number;\n  rateVariation: number;\n\n  constructor(options: LottieControllerConfig = {}) {\n    const {\n      debug = false,\n      injectCSS = true,\n      volumeVariation = 0,\n      rateVariation = 0,\n      howlerOptions = {},\n      ...lottieOptions\n    } = options;\n\n    this.debug = debug;\n    this.volumeVariation = volumeVariation;\n    this.rateVariation = rateVariation;\n\n    if (injectCSS) {\n      let style = document.querySelector(\"style[data-type=lottie-controller]\");\n      if (!style) {\n        style = document.createElement(\"style\");\n        style.setAttribute(\"data-type\", \"lottie-controller\");\n        style.innerHTML = styleContent;\n        document.body.appendChild(style);\n      }\n    }\n    // let animation;\n\n    this.container =\n      typeof options.container === \"string\"\n        ? (() => {\n            const elem = getElem(options.container);\n            if (!elem) {\n              throw new Error(`Element not found: ${options.container}`);\n            }\n            return elem;\n          })()\n        : options.container || document.body;\n\n    this.player = lottie.loadAnimation({\n      renderer: \"svg\", // Render method ('svg', 'canvas', or 'html')\n      loop: false, // Set looping to true\n      autoplay: false, // Set to true for autoplaying the animation\n      audioFactory(assetPath) {\n        const audio = new SustainHowl({\n          src: assetPath,\n          html5: isIOS() ? true : false,\n          // preload: true,\n          ...howlerOptions,\n        });\n        return audio;\n      },\n      ...lottieOptions,\n\n      container: this.container,\n    }) as unknown as CompleteAnimationItem;\n\n    this.player.addEventListener(\"DOMLoaded\", () => {\n      const { fileName } = this.player;\n      document.title = firstCap(fileName);\n\n      const container = this.getElem() as HTMLElement;\n      if (!container) return;\n      // Disable right click\n\n      container.dataset.filename = this.player.fileName;\n      container.classList.add(\"lottie-controller\");\n      container.addEventListener(\n        \"contextmenu\",\n        (event) => {\n          event.preventDefault();\n          event.stopPropagation();\n          return false;\n        },\n        true\n      );\n\n      // this.getElem().onclick = () => {\n      //   Howler._unlockAudio();\n      // };\n    });\n\n    let oldFrame = Infinity;\n\n    this.player.addEventListener(\"enterFrame\", (event) => {\n      if (event.direction !== 1) return;\n      if (this.player.isPaused) return;\n\n      const { audios } = this.player.audioController || { audios: [] };\n      const frame = this.player.firstFrame + this.player.currentFrame;\n\n      audios.forEach(({ audio, data }) => {\n        const { st } = data;\n\n        if (st <= frame && st > oldFrame) {\n          const rate = this.rateVariation * 0.5;\n          audio.manualRate(random(1 - rate, 1 + rate));\n          audio.manualVolume(random(1 - this.volumeVariation, 1));\n          const event = { audios, audio, data, willPlay: true } as BMAudioEvent;\n          this.player.triggerEvent(\"audio\", event);\n          if (event.willPlay) audio.manualPlay();\n        }\n      });\n\n      oldFrame = frame;\n    });\n  }\n\n  onComplete = (callback: Callback) => {\n    return this.player.addEventListener(\"complete\", callback);\n  };\n  onLoad = (callback: Callback) => {\n    return this.player.addEventListener(\"DOMLoaded\", callback);\n  };\n  onAudio = (callback: Callback) => {\n    return this.player.addEventListener(\"audio\", callback);\n  };\n  getElem = (selector?: string | null, parent?: Element | null) => {\n    parent ||= this.player.renderer.svgElement;\n    // parent ||= this.container;\n    if (!selector) return parent;\n    return getElem(selector, parent || undefined);\n  };\n  getElems = (selector: string, parent?: Element | null) => {\n    parent ||= this.player.renderer.svgElement;\n    return getElems(selector, parent || undefined);\n  };\n  isPlaying = (...acts: string[]) => {\n    return this.animation !== null && acts.includes(this.animation);\n  };\n  currentAnimation = () => {\n    return this.animation;\n  };\n  play = (anim: string, { loop = false, force = true } = {}) => {\n    this.animation = anim;\n\n    const container = this.getElem() as HTMLElement;\n    if (container) container.dataset.animation = anim;\n\n    this.player.loop = loop;\n    if (this.debug) console.log(\"playing:\", anim);\n\n    playAnimation(this.player, anim, force);\n  };\n\n  destroy = () => {\n    this.player.destroy();\n  };\n}\n", "import { Howl, HowlOptions } from \"howler\";\n\nexport interface SustainHowlOptions extends HowlOptions {\n \n}\n\nexport default class SustainHowl extends Howl {\n  constructor(options: SustainHowlOptions) {\n    super(options);\n    // super.on(\"end\", () => {\n    //   // this.isPlaying = false;\n    // });\n  }\n\n  manualSeek(value: number) {\n    return super.seek(value);\n  }\n  manualPlay() {\n    return super.play();\n  }\n  manualRate(value: number) {\n    return super.rate(value);\n  }\n  manualVolume(value: number) {\n    return super.volume(value);\n  }\n  playing() {\n    return false;\n  }\n  setVolume() {}\n  //@ts-ignore\n  seek() {\n    return super.seek();\n  }\n  //@ts-ignore\n  rate() {\n    return super.rate();\n  }\n  pause() {\n    return this;\n  }\n  play() {\n    return -1;\n  }\n}\n", "export default `/* prevent zoom */\nsvg.lottie-controller {\n  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);\n  -webkit-tap-highlight-color: transparent;\n  -webkit-touch-callout: none;\n  overflow: visible;\n}\nsvg.lottie-controller > g[clip-path] {\n  clip-path: unset;\n}\nsvg.lottie-controller * {\n  touch-action: none;\n  box-sizing: border-box;\n  user-select: none;\n  -webkit-user-select: none;\n}\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VSb290IjoiL1VzZXJzL21hdG9zZWIvRG9jdW1lbnRzL0dpdEh1Yi91c2Vsb3R0aWUvc3JjL3VzZWxvdHRpZSIsInNvdXJjZXMiOlsiaW5kZXguc2NzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUVBO0VBQ0U7RUFDQTtFQUNBO0VBQ0E7O0FBRUE7RUFDRTs7QUFHRjtFQUNFO0VBQ0E7RUFDQTtFQUNBIiwic291cmNlc0NvbnRlbnQiOlsiLyogcHJldmVudCB6b29tICovXG5cbnN2Zy5sb3R0aWUtY29udHJvbGxlciB7XG4gIC13ZWJraXQtdGFwLWhpZ2hsaWdodC1jb2xvcjogcmdiYSgwLCAwLCAwLCAwKTtcbiAgLXdlYmtpdC10YXAtaGlnaGxpZ2h0LWNvbG9yOiB0cmFuc3BhcmVudDtcbiAgLXdlYmtpdC10b3VjaC1jYWxsb3V0OiBub25lO1xuICBvdmVyZmxvdzogdmlzaWJsZTtcblxuICA+IGdbY2xpcC1wYXRoXSB7XG4gICAgY2xpcC1wYXRoOiB1bnNldDtcbiAgfVxuXG4gICoge1xuICAgIHRvdWNoLWFjdGlvbjogbm9uZTtcbiAgICBib3gtc2l6aW5nOiBib3JkZXItYm94O1xuICAgIHVzZXItc2VsZWN0OiBub25lO1xuICAgIC13ZWJraXQtdXNlci1zZWxlY3Q6IG5vbmU7XG4gIH1cbn1cbiJdfQ== */`;\n", "import {\n  AnimationItem,\n  AnimationSegment,\n  AnimationEventName,\n  BMEnterFrameEvent,\n  BMCompleteLoopEvent,\n  BMCompleteEvent,\n  BMSegmentStartEvent,\n  BMDestroyEvent,\n} from \"lottie-web\";\n\nimport SustainHowl from \"./SustainHowl\";\n\ninterface Marker {\n  payload: {\n    name: string;\n  };\n  time: number;\n}\n\ninterface AudioControl {\n  audio: SustainHowl;\n  data: any;\n}\n\nexport interface BMAudioEvent {\n  audios: AudioControl[];\n  audio: SustainHowl;\n  data: any;\n  willPlay: boolean;\n}\n\ntype CompleteAnimationEventName = \"audio\" | AnimationEventName;\n\nexport interface CompleteAnimationItem extends AnimationItem {\n  markers: Marker[];\n  fileName: string;\n  audioController?: {\n    audios: AudioControl[];\n  };\n  addEventListener: (\n    name: CompleteAnimationEventName,\n    callback: (event: any) => void\n  ) => (() => void);\n  removeEventListener: (\n    name: CompleteAnimationEventName,\n    callback: (event: any) => void\n  ) => void;\n  triggerEvent: (\n    name: CompleteAnimationEventName,\n    event:\n      | BMAudioEvent\n      | BMEnterFrameEvent\n      | BMCompleteLoopEvent\n      | BMCompleteEvent\n      | BMSegmentStartEvent\n      | BMDestroyEvent\n      | undefined\n  ) => void;\n}\n\n// lottie\nexport function getMarker(player: CompleteAnimationItem, name: string) {\n  return player.markers.find((marker: Marker) => marker.payload.name === name);\n}\n\nexport function isIOS() {\n  return /iPad|iPhone|iPod/.test(navigator.userAgent);\n}\n\nexport function playAnimation(\n  player: CompleteAnimationItem,\n  animation: string,\n  force = true\n) {\n  const addFrame = player.loop ? 0 : 1;\n\n  // transform to array and add extra frame if sequence\n\n  const frames: number[] = [];\n\n  animation\n    .split(\",\")\n    .filter(Boolean)\n    .slice(0, 2)\n    .map((name, index) => {\n      let marker = getMarker(player, name.trim());\n      if (!marker) return;\n      const frame = marker.time + (index > 0 ? addFrame : 0);\n      frames.push(frame);\n    });\n\n  if (frames.length <= 1) {\n    player.goToAndStop(frames[0] || 0, true);\n    return;\n  }\n\n  player.playSegments(frames as AnimationSegment, force);\n}\n\n// DOM\nexport function getElem(\n  selector: string,\n  parent: Element | Document = document\n) {\n  return parent.querySelector(selector);\n}\nexport function getElems(\n  selector: string,\n  parent: Element | Document = document\n) {\n  return Array.from(parent.querySelectorAll(selector));\n}\n\n// math\nexport function random(min: number, max: number) {\n  return Math.random() * (max - min) + min;\n}\n\n// text\nexport function firstCap(text: string) {\n  return text.charAt(0).toUpperCase() + text.slice(1);\n}\n"],
  "mappings": "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",
  "names": ["uselottie_exports", "__export", "useLottie", "__toCommonJS", "import_lottie_web", "import_howler", "SustainHowl", "options", "value", "uselottie_default", "getMarker", "player", "name", "marker", "isIOS", "playAnimation", "animation", "force", "addFrame", "frames", "index", "frame", "getElem", "selector", "parent", "getElems", "random", "min", "max", "firstCap", "text", "LottieController", "options", "debug", "injectCSS", "volumeVariation", "rateVariation", "howlerOptions", "lottieOptions", "style", "uselottie_default", "elem", "getElem", "lottie", "assetPath", "SustainHowl", "isIOS", "fileName", "firstCap", "container", "event", "oldFrame", "audios", "frame", "audio", "data", "st", "rate", "random", "callback", "selector", "parent", "getElems", "acts", "anim", "loop", "force", "playAnimation", "useLottie", "options", "LottieController"]
}
